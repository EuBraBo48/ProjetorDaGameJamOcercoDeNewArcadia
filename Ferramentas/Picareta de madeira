extends Area2D

var durabilidade: int = 20
var rng = RandomNumberGenerator.new()
var jogador: KinematicBody2D
var pedras: Array = [] # Lista para armazenar referências às pedras

func _ready():
	jogador = get_parent().get_node("jogador")
	rng.randomize()
	
	# Coletar todas as pedras na cena (assumindo que estão no mesmo nível do pai)
	var world = get_parent()
	for child in world.get_children():
		if child.is_in_group("pedra"):
			pedras.append(child)

func _process(delta):
	if durabilidade <= 0:
		self.queue_free()
	
	# Verifica se a tecla de ataque é pressionada
	if Input.is_action_just_pressed("atirar"):
		atacar()

func atacar():
	for pedra in pedras:
		if pedra and is_instance_valid(pedra): # Verifica se a pedra ainda é válida
			jogador.inventario_recurssos["pedra"] += 1
			pedra.vida -= int(rng.randi_range(20, 40))
			durabilidade -= 2
			print(jogador.inventario_recurssos)
			print(pedra.vida)
			print(durabilidade)
			# Caso queira remover uma pedra destruída da lista
			if pedra.vida <= 0:
				pedras.erase(pedra)
			break # Atacar apenas uma pedra por vez
